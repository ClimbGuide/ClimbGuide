{% extends "base.html" %}

{% block content %}
<h2>{{ daytrip.title }}</h2>
<div>
    {{ daytrip.date }}<br>
    {{ daytrip.description }}<br>
</div><br>
<div>
    <a href="{% url 'edit_daytrip' daytrip_pk=daytrip.pk%}"><button>Update Trip</button></a>
    <a href="{% url 'delete_daytrip' daytrip_pk=daytrip.pk %}"><button>Delete Trip</button></a>
</div><br>
<div>We will use mapbox to do these things below:</div>
<div>1) Show all routes on mapbox, the routes queried for this view are have been added to the trip</div>
<div>2) When you click on a route, you get the pop up with option inspect the route further, like the homepage</div>
<div>3) Show pointsofinterest</div><br>
<div id='map' style='width: 400px; height: 300px;'></div>

{{ route_info|json_script:"route_info" }}

<script>
document.addEventListener("DOMContentLoaded", (e) => {
    const route_info = JSON.parse(document.getElementById("route_info").textContent)
    mapboxgl.accessToken = '{{mapbox_access_token}}';
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [-80.793457, 35.782169],
        zoom: 4,
    })
    console.log("map loaded!")
    for (let i = 0; i < route_info.length; i++) {
        let route = route_info[i]
        console.log(route.name)
        var html =  `<div style="border-radius: 3px; width: 200px;">
                        <h4 style="border-radius: 2px;">${route.name}</h4>
                        <div>${route.route_type} | ${route.rating}</div>
                        <a href="/routes/detail/${route.pk}" class="marker-popup">See the route!</a>
                    </div>`
        var customPopUp = new mapboxgl.Popup({
            anchor: "bottom",
            offset: { "bottom" : [0, -10]},
            closeOnClick: false
        }).setHTML(html);

        let color = "green"
        var marker = new mapboxgl.Marker(
            {color: color}
        )
            .setLngLat([route.longitude, route.latitude])
            .setPopup(customPopUp)
            .addTo(map);
    }
})
</script>


{% endblock %}